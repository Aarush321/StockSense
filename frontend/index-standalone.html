<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockSense</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob {
            animation: blob 7s infinite;
        }
        .animation-delay-2000 {
            animation-delay: 2s;
        }
        .animation-delay-4000 {
            animation-delay: 4s;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;

        // API Service - Auto-detect production vs development
        const API_BASE = (() => {
            // In production (Netlify), use Render backend URL
            // Replace 'YOUR_RENDER_BACKEND_URL' with your actual Render URL
            const isProduction = window.location.hostname !== 'localhost' && 
                                window.location.hostname !== '127.0.0.1' &&
                                !window.location.hostname.startsWith('192.168.');
            
            if (isProduction) {
                // Production: Use Render backend URL
                return 'https://stocksense-backend-pd7x.onrender.com/api';
            }
            // Development - use localhost
            return 'http://localhost:5001/api';
        })();
        
        const analyzeStock = async (symbol) => {
            const response = await fetch(`${API_BASE}/analyze`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ symbol })
            });
            if (!response.ok) throw new Error('Failed to analyze stock');
            return response.json();
        };

        const getStarredStocks = async () => {
            const response = await fetch(`${API_BASE}/starred`);
            if (!response.ok) return [];
            return response.json();
        };

        const getStockPrices = async (symbols) => {
            const response = await fetch(`${API_BASE}/prices`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ symbols })
            });
            if (!response.ok) throw new Error('Failed to fetch prices');
            return response.json();
        };

        const starStock = async (symbol) => {
            await fetch(`${API_BASE}/star`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ symbol })
            });
        };

        const unstarStock = async (symbol) => {
            await fetch(`${API_BASE}/star/${symbol}`, { method: 'DELETE' });
        };

        const getMarketNews = async () => {
            try {
                const response = await fetch(`${API_BASE}/market-news`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching market news:', error);
                throw error;
            }
        };

        const sendChatMessage = async (message) => {
            try {
                const response = await fetch(`${API_BASE}/chatbot`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                if (data.error) {
                    throw new Error(data.error);
                }
                if (!data.response) {
                    throw new Error('No response from server');
                }
                return data.response;
            } catch (error) {
                console.error('Error sending chat message:', error);
                throw error;
            }
        };

        // Stock Context
        const StockContext = createContext();

        function StockProvider({ children }) {
            const [starredStocks, setStarredStocks] = useState([]);
            const [loading, setLoading] = useState(false);

            useEffect(() => { loadStarredStocks(); }, []);

            const loadStarredStocks = async () => {
                try {
                    setLoading(true);
                    const stocks = await getStarredStocks();
                    setStarredStocks(stocks);
                } catch (error) {
                    console.error('Failed to load starred stocks:', error);
                } finally {
                    setLoading(false);
                }
            };

            const addStarredStock = async (symbol) => {
                try {
                    await starStock(symbol);
                    await loadStarredStocks();
                } catch (error) {
                    console.error('Failed to star stock:', error);
                }
            };

            const removeStarredStock = async (symbol) => {
                try {
                    await unstarStock(symbol);
                    await loadStarredStocks();
                } catch (error) {
                    console.error('Failed to unstar stock:', error);
                }
            };

            const isStarred = (symbol) => {
                return starredStocks.some(stock => stock.symbol === symbol.toUpperCase());
            };

            return (
                <StockContext.Provider value={{
                    starredStocks, loading, addStarredStock, removeStarredStock,
                    isStarred, refreshStarredStocks: loadStarredStocks
                }}>
                    {children}
                </StockContext.Provider>
            );
        }

        function useStock() {
            const context = useContext(StockContext);
            if (!context) throw new Error('useStock must be used within StockProvider');
            return context;
        }

        // StarredStocks Component
        function StarredStocks({ onStockSelect }) {
            const { starredStocks, loading } = useStock();
            const [stockData, setStockData] = useState({});

            useEffect(() => {
                // Load price data for all starred stocks in parallel
                const loadStockData = async () => {
                    if (starredStocks.length === 0) {
                        setStockData({});
                        return;
                    }
                    
                    try {
                        // Get all symbols
                        const symbols = starredStocks.map(stock => stock.symbol);
                        
                        // Fetch all prices in parallel (much faster!)
                        const prices = await getStockPrices(symbols);
                        
                        // Convert to the format expected by the component
                        const data = {};
                        for (const symbol of symbols) {
                            const priceInfo = prices[symbol];
                            if (priceInfo && !priceInfo.error) {
                                data[symbol] = {
                                    company: {
                                        name: priceInfo.name,
                                        currentPrice: priceInfo.currentPrice,
                                        changePercent: priceInfo.changePercent
                                    }
                                };
                            }
                        }
                        setStockData(data);
                    } catch (err) {
                        console.error('Failed to load stock prices:', err);
                        setStockData({});
                    }
                };

                loadStockData();
            }, [starredStocks]);

            if (loading) {
                return (
                    <div className="bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-6 mb-8">
                        <h2 className="text-2xl font-bold text-gray-800 mb-4">Starred Stocks</h2>
                        <p className="text-gray-500">Loading...</p>
                    </div>
                );
            }

            if (starredStocks.length === 0) {
                return (
                    <div className="bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-6 mb-8">
                        <h2 className="text-2xl font-bold text-gray-800 mb-4">Starred Stocks</h2>
                        <p className="text-gray-500 text-center py-8">
                            No starred stocks yet. Search for a stock and click the star icon to save it here.
                        </p>
                    </div>
                );
            }

            return (
                <div className="bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-6 mb-8">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">Starred Stocks</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                        {starredStocks.map((stock) => {
                            const data = stockData[stock.symbol];
                            const company = data?.company;
                            
                            return (
                                <div
                                    key={stock.symbol}
                                    onClick={() => onStockSelect(stock.symbol)}
                                    className="bg-white/60 backdrop-blur-sm border-2 border-gray-200 rounded-xl p-5 hover:shadow-xl hover:border-gray-400 hover:scale-105 transition-all duration-200 cursor-pointer"
                                >
                                    <div className="flex items-start justify-between mb-2">
                                        <div>
                                            <h3 className="font-bold text-lg text-gray-900">{company?.name || stock.symbol}</h3>
                                            <p className="text-sm text-gray-500">{stock.symbol}</p>
                                        </div>
                                        <svg className="w-5 h-5 text-yellow-500 fill-current" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                        </svg>
                                    </div>
                                    
                                    {company && company.currentPrice !== undefined ? (
                                        <div className="mt-3">
                                            <div className="flex items-baseline gap-2 mb-1">
                                                <span className="text-xl font-bold text-gray-900">
                                                    ${company.currentPrice?.toFixed(2) || '0.00'}
                                                </span>
                                                <span className={`text-sm font-semibold ${
                                                    (company.changePercent || 0) >= 0 ? 'text-green-600' : 'text-red-600'
                                                }`}>
                                                    {(company.changePercent || 0) >= 0 ? '↑' : '↓'} {Math.abs(company.changePercent || 0).toFixed(2)}%
                                                </span>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="mt-3 text-sm text-gray-400">Loading...</div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        // SearchBar Component
        function SearchBar({ onAnalysisComplete }) {
            const [symbol, setSymbol] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!symbol.trim()) {
                    setError('Please enter a stock symbol');
                    return;
                }
                setLoading(true);
                setError(null);
                try {
                    await analyzeStock(symbol.trim().toUpperCase());
                    onAnalysisComplete(symbol.trim().toUpperCase());
                } catch (err) {
                    setError(err.message || 'Failed to analyze stock');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-8 mb-8 hover:shadow-2xl transition-all duration-300">
                    <form onSubmit={handleSubmit} className="flex gap-4">
                        <div className="flex-1">
                            <label className="block text-sm font-semibold text-gray-700 mb-3">
                                Enter Stock Symbol
                            </label>
                            <input
                                type="text"
                                value={symbol}
                                onChange={(e) => setSymbol(e.target.value.toUpperCase())}
                                placeholder="e.g., AAPL, TSLA, GOOGL"
                                className="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-gray-500 focus:border-gray-500 text-lg transition-all duration-200 bg-white/50"
                                disabled={loading}
                            />
                            {error && <p className="mt-2 text-sm text-red-600 font-medium">{error}</p>}
                        </div>
                        <div className="flex items-end">
                            <button
                                type="submit"
                                disabled={loading}
                                className="px-10 py-4 bg-gray-800 text-white rounded-xl hover:bg-gray-900 disabled:opacity-50 font-semibold shadow-lg shadow-gray-900/20 hover:shadow-xl hover:shadow-gray-900/30 transition-all duration-200 hover:scale-105"
                            >
                                {loading ? 'Analyzing...' : 'Analyze Stock'}
                            </button>
                        </div>
                    </form>
                </div>
            );
        }

        // StockAnalysis Component
        function StockAnalysis({ symbol }) {
            const [analysis, setAnalysis] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const { isStarred, addStarredStock, removeStarredStock } = useStock();

            useEffect(() => {
                loadAnalysis();
            }, [symbol]);

            const loadAnalysis = async () => {
                setLoading(true);
                setError(null);
                try {
                    const data = await analyzeStock(symbol);
                    setAnalysis(data);
                } catch (err) {
                    setError(err.message || 'Failed to load analysis');
                } finally {
                    setLoading(false);
                }
            };

            const handleStarToggle = async () => {
                try {
                    if (isStarred(symbol)) {
                        await removeStarredStock(symbol);
                    } else {
                        await addStarredStock(symbol);
                    }
                } catch (err) {
                    alert('Failed to update starred stocks: ' + err.message);
                }
            };

            if (loading) {
                return (
                    <div className="flex items-center justify-center py-12">
                        <div className="text-center">
                            <div className="animate-spin h-12 w-12 text-gray-600 mx-auto mb-4 border-4 border-gray-200 border-t-gray-600 rounded-full"></div>
                            <p className="text-gray-600">Analyzing {symbol}...</p>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="bg-red-50 border border-red-200 rounded-lg p-6">
                        <h3 className="text-red-800 font-semibold mb-2">Error</h3>
                        <p className="text-red-600">{error}</p>
                        <button onClick={loadAnalysis} className="mt-4 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                            Try Again
                        </button>
                    </div>
                );
            }

            if (!analysis) return null;

            const { company, news, sentiment, analyst, ai_recommendation } = analysis;

            return (
                <div className="space-y-4">
                    <div className="bg-white rounded-lg shadow-md p-5">
                        <div className="flex items-start justify-between mb-3">
                            <div>
                                <div className="flex items-center gap-3 mb-1.5">
                                    <h2 className="text-3xl font-bold text-gray-900">{company?.name || symbol}</h2>
                                    <span className="text-xl text-gray-500">({symbol})</span>
                                    <button 
                                        onClick={handleStarToggle} 
                                        className="p-1 hover:scale-110 transition-transform"
                                        title={isStarred(symbol) ? 'Remove from starred' : 'Add to starred'}
                                    >
                                        {isStarred(symbol) ? (
                                            <svg className="w-6 h-6 text-yellow-500 fill-current" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                            </svg>
                                        ) : (
                                            <svg className="w-6 h-6 text-gray-400 hover:text-yellow-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                                            </svg>
                                        )}
                                    </button>
                                </div>
                                <div className="flex flex-wrap gap-4 text-sm text-gray-600">
                                    <span><span className="font-semibold">Sector:</span> {company?.sector || 'N/A'}</span>
                                    {company?.yearsPublic && <span><span className="font-semibold">Public Since:</span> {company.yearsPublic} years</span>}
                                </div>
                            </div>
                        </div>
                        <div className="flex items-baseline gap-4">
                            <span className="text-4xl font-bold text-gray-900">
                                ${company?.currentPrice?.toFixed(2) || '0.00'}
                            </span>
                            <span className={`text-2xl font-semibold ${(company?.changePercent || 0) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                {(company?.changePercent || 0) >= 0 ? '↑' : '↓'} {Math.abs(company?.changePercent || 0).toFixed(2)}%
                            </span>
                        </div>
                    </div>

                    {ai_recommendation && (
                        <div className="bg-white rounded-lg shadow-md p-5 border-l-4 border-gray-300">
                            <h3 className="text-xl font-bold text-gray-900 mb-3">
                                Analysis:
                            </h3>
                            {ai_recommendation.riskLevel && (
                                <div className="mb-3">
                                    <span className={`inline-block px-3 py-1 rounded-full text-sm font-semibold ${
                                        ai_recommendation.riskLevel.includes('Low') ? 'bg-green-100 text-green-600' :
                                        ai_recommendation.riskLevel.includes('High') ? 'bg-red-100 text-red-600' :
                                        'bg-yellow-100 text-yellow-600'
                                    }`}>
                                        Risk Level: {ai_recommendation.riskLevel}
                                    </span>
                                </div>
                            )}
                            {ai_recommendation.reasoning && (
                                <div className="mt-2">
                                    <div className="text-gray-700 whitespace-pre-wrap leading-relaxed prose prose-sm max-w-none" style={{maxHeight: 'none', overflow: 'visible'}}>
                                        {ai_recommendation.reasoning.split('\n').map((line, idx) => {
                                            // Format bold text
                                            if (line.includes('**') && line.trim().startsWith('**')) {
                                                const boldMatch = line.match(/\*\*(.*?)\*\*/);
                                                if (boldMatch) {
                                                    return (
                                                        <div key={idx} className="mt-3 mb-1.5">
                                                            <h4 className="text-base font-bold text-gray-900">{boldMatch[1]}</h4>
                                                        </div>
                                                    );
                                                }
                                            }
                                            // Format bullet points with bold titles
                                            if (line.trim().startsWith('•') && line.includes('**')) {
                                                const parts = line.split(/\*\*(.*?)\*\*/);
                                                return (
                                                    <div key={idx} className="mb-2 ml-4">
                                                        <span className="font-bold text-gray-900">{parts[1]}</span>
                                                        <span className="text-gray-700">: {parts[2]}</span>
                                                    </div>
                                                );
                                            }
                                            // Regular paragraphs
                                            if (line.trim() && !line.trim().startsWith('•')) {
                                                return <p key={idx} className="mb-1.5 text-sm">{line}</p>;
                                            }
                                            // Bullet points
                                            if (line.trim().startsWith('•')) {
                                                return <div key={idx} className="mb-1.5 ml-4 text-sm">{line}</div>;
                                            }
                                            // Empty lines - reduce spacing
                                            if (line.trim() === '') {
                                                return null;
                                            }
                                            return null;
                                        })}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {sentiment && (
                        <div className="bg-white rounded-lg shadow-md p-5">
                            <h3 className="text-lg font-bold text-gray-900 mb-3">Social Sentiment</h3>
                            {sentiment.stocktwits && (
                                <div className="mb-3">
                                    <div className="flex justify-between mb-1.5">
                                        <span className="text-sm font-medium"> StockTwits</span>
                                        <span className="text-xs text-gray-500">{sentiment.stocktwits.totalMentions || 0} mentions</span>
                                    </div>
                                    <div className="flex h-6 rounded-md overflow-hidden border">
                                        <div className="bg-green-500" style={{width: `${sentiment.stocktwits.positive || 0}%`}}></div>
                                        <div className="bg-yellow-500" style={{width: `${sentiment.stocktwits.neutral || 0}%`}}></div>
                                        <div className="bg-red-500" style={{width: `${sentiment.stocktwits.negative || 0}%`}}></div>
                                    </div>
                                    {sentiment.stocktwits.sample && (
                                        <p className="text-xs text-gray-600 mt-1.5 italic">{sentiment.stocktwits.sample}</p>
                                    )}
                                </div>
                            )}
                            {sentiment.reddit && (
                                <div className="mb-3">
                                    <div className="flex justify-between mb-1.5">
                                        <span className="text-sm font-medium"> Reddit</span>
                                        <span className="text-xs text-gray-500">{sentiment.reddit.totalMentions || 0} mentions</span>
                                    </div>
                                    <div className="flex h-6 rounded-md overflow-hidden border">
                                        <div className="bg-green-500" style={{width: `${sentiment.reddit.positive || 0}%`}}></div>
                                        <div className="bg-yellow-500" style={{width: `${sentiment.reddit.neutral || 0}%`}}></div>
                                        <div className="bg-red-500" style={{width: `${sentiment.reddit.negative || 0}%`}}></div>
                                    </div>
                                    {sentiment.reddit.sample && (
                                        <p className="text-xs text-gray-600 mt-1.5 italic">{sentiment.reddit.sample}</p>
                                    )}
                                </div>
                            )}
                            {sentiment.searchInterest && (
                                <div>
                                    <div className="flex justify-between mb-1.5">
                                        <span className="text-sm font-medium"> Google News Sentiment</span>
                                        <span className="text-xs text-gray-500">{sentiment.searchInterest.totalMentions || 0} articles analyzed</span>
                                    </div>
                                    <div className="flex h-6 rounded-md overflow-hidden border">
                                        <div className="bg-green-500" style={{width: `${sentiment.searchInterest.positive || 0}%`}}></div>
                                        <div className="bg-yellow-500" style={{width: `${sentiment.searchInterest.neutral || 0}%`}}></div>
                                        <div className="bg-red-500" style={{width: `${sentiment.searchInterest.negative || 0}%`}}></div>
                                    </div>
                                    {sentiment.searchInterest.sample && (
                                        <p className="text-xs text-gray-600 mt-1.5 italic">{sentiment.searchInterest.sample}</p>
                                    )}
                                </div>
                            )}
                        </div>
                    )}

                    {analyst && (
                        <div className="bg-white rounded-lg shadow-md p-5">
                            <h3 className="text-lg font-bold text-gray-900 mb-3">Professional Analyst Opinions</h3>
                            <div className="grid grid-cols-3 gap-3">
                                <div className="text-center p-4 bg-green-50 rounded-lg">
                                    <div className="text-3xl font-bold text-green-600">{analyst.buyCount || 0}</div>
                                    <div className="text-sm text-gray-600">Buy</div>
                                </div>
                                <div className="text-center p-4 bg-yellow-50 rounded-lg">
                                    <div className="text-3xl font-bold text-yellow-600">{analyst.holdCount || 0}</div>
                                    <div className="text-sm text-gray-600">Hold</div>
                                </div>
                                <div className="text-center p-4 bg-red-50 rounded-lg">
                                    <div className="text-3xl font-bold text-red-600">{analyst.sellCount || 0}</div>
                                    <div className="text-sm text-gray-600">Sell</div>
                                </div>
                            </div>
                            {analyst.averagePriceTarget && (
                                <div className="mt-4 pt-4 border-t">
                                    <div className="text-sm text-gray-500 mb-1">Average Price Target</div>
                                    <div className="text-lg font-semibold text-gray-700">${analyst.averagePriceTarget.toFixed(2)}</div>
                                </div>
                            )}
                        </div>
                    )}

                    {news && news.length > 0 && (
                        <div className="bg-white rounded-lg shadow-md p-5">
                            <h3 className="text-lg font-bold text-gray-900 mb-3">Recent News</h3>
                            <div className="space-y-3">
                                {news.slice(0, 10).map((article, idx) => (
                                    article.url ? (
                                        <a 
                                            key={idx} 
                                            href={article.url} 
                                            target="_blank" 
                                            rel="noopener noreferrer"
                                            className="block border-b pb-3 last:border-b-0 hover:bg-gray-50 p-2 -m-2 rounded-lg transition-colors cursor-pointer"
                                        >
                                            <h4 className="font-semibold text-gray-900 mb-1.5 hover:text-gray-600 transition-colors text-sm">
                                                {article.headline || 'No headline'}
                                            </h4>
                                            {article.summary && (
                                                <p className="text-xs text-gray-600 mb-1.5">
                                                    {article.summary.substring(0, 150)}{article.summary.length > 150 ? '...' : ''}
                                                </p>
                                            )}
                                            <div className="flex items-center gap-4 text-xs text-gray-500">
                                                <span className="text-gray-600 font-medium">Click to read full article →</span>
                                            </div>
                                        </a>
                                    ) : (
                                        <div key={idx} className="border-b pb-3 last:border-b-0">
                                            <h4 className="font-semibold text-gray-900 mb-1.5 text-sm">{article.headline || 'No headline'}</h4>
                                            {article.summary && (
                                                <p className="text-xs text-gray-600 mb-1.5">
                                                    {article.summary.substring(0, 150)}{article.summary.length > 150 ? '...' : ''}
                                                </p>
                                            )}
                                            <div className="flex items-center gap-4 text-xs text-gray-500">
                                                <span className="text-gray-400">No link available</span>
                                            </div>
                                        </div>
                                    )
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // MarketNews Component
        function MarketNews() {
            const [news, setNews] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                const fetchNews = async () => {
                    setLoading(true);
                    setError(null);
                    try {
                        const data = await getMarketNews();
                        setNews(data);
                    } catch (err) {
                        setError(err.message || 'Failed to load market news');
                    } finally {
                        setLoading(false);
                    }
                };
                fetchNews();
            }, []);

            const formatDate = (timestamp) => {
                if (!timestamp) return 'Date unknown';
                try {
                    const date = new Date(timestamp * 1000);
                    return date.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch {
                    return 'Date unknown';
                }
            };

            if (loading) {
                return (
                    <div className="bg-white rounded-lg shadow-md p-8 text-center">
                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-600 mx-auto mb-4"></div>
                        <p className="text-gray-600">Loading market news...</p>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="bg-white rounded-lg shadow-md p-8 text-center">
                        <p className="text-red-600 mb-2 font-semibold">Failed to load market news</p>
                        <p className="text-gray-500 text-sm mb-4">{error}</p>
                        <p className="text-gray-400 text-xs mb-4">Make sure the backend server is running on port 5001</p>
                        <button
                            onClick={() => {
                                setError(null);
                                setLoading(true);
                                getMarketNews().then(data => {
                                    setNews(data);
                                    setLoading(false);
                                }).catch(err => {
                                    setError(err.message);
                                    setLoading(false);
                                });
                            }}
                            className="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700"
                        >
                            Retry
                        </button>
                    </div>
                );
            }

            return (
                <div className="bg-white rounded-lg shadow-md p-6">
                    <h2 className="text-2xl font-bold text-gray-900 mb-6">Today's Stock Market News</h2>
                    {news.length === 0 ? (
                        <p className="text-gray-500 text-center py-8">No market news available at this time.</p>
                    ) : (
                        <div className="space-y-6">
                            {news.map((article, index) => (
                                <div
                                    key={index}
                                    className="border-b border-gray-200 pb-6 last:border-b-0 last:pb-0"
                                >
                                    {article.url ? (
                                        <a
                                            href={article.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="block hover:bg-gray-50 p-3 -m-3 rounded-lg transition-colors"
                                        >
                                            <div className="flex gap-4">
                                                <div className="flex-1">
                                                    <h3 className="text-lg font-semibold text-gray-900 mb-2 hover:text-gray-600 transition-colors">
                                                        {article.headline || 'No headline'}
                                                    </h3>
                                                    {article.summary && (
                                                        <p className="text-sm text-gray-600 mb-2">
                                                            {article.summary}
                                                        </p>
                                                    )}
                                                    <div className="flex items-center gap-4 text-xs text-gray-500 mt-2">
                                                        <span>{formatDate(article.date)}</span>
                                                        <span className="text-gray-600 font-medium">Read full article →</span>
                                                    </div>
                                                </div>
                                                {article.image && (
                                                    <div className="flex-shrink-0">
                                                        <img
                                                            src={article.image}
                                                            alt={article.headline}
                                                            className="w-32 h-32 object-cover rounded-lg"
                                                            onError={(e) => {
                                                                e.target.style.display = 'none';
                                                            }}
                                                        />
                                                    </div>
                                                )}
                                            </div>
                                        </a>
                                    ) : (
                                        <div className="flex gap-4">
                                            <div className="flex-1">
                                                <h3 className="text-lg font-semibold text-gray-900 mb-2">
                                                    {article.headline || 'No headline'}
                                                </h3>
                                                {article.summary && (
                                                    <p className="text-sm text-gray-600 mb-2">
                                                        {article.summary}
                                                    </p>
                                                )}
                                                <div className="flex items-center justify-between text-xs text-gray-500 mt-2">
                                                    <span>{formatDate(article.date)}</span>
                                                </div>
                                            </div>
                                            {article.image && (
                                                <div className="flex-shrink-0">
                                                    <img
                                                        src={article.image}
                                                        alt={article.headline}
                                                        className="w-32 h-32 object-cover rounded-lg"
                                                        onError={(e) => {
                                                            e.target.style.display = 'none';
                                                        }}
                                                    />
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Splash Screen Component
        function SplashScreen({ onComplete }) {
            const [showContent, setShowContent] = useState(false);
            const [drawProgress, setDrawProgress] = useState(0);
            const [isExiting, setIsExiting] = useState(false);

            useEffect(() => {
                // Fade in content after a brief delay
                const timer = setTimeout(() => setShowContent(true), 300);
                return () => clearTimeout(timer);
            }, []);

            const handleClick = () => {
                setIsExiting(true);
                // Wait for fade-out animation to complete before transitioning
                setTimeout(() => {
                    onComplete();
                }, 500); // Match the transition duration
            };

            // Animate the drawing of the stock chart
            useEffect(() => {
                const duration = 2000; // 2 seconds to draw
                const startTime = Date.now();
                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    setDrawProgress(progress);
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                requestAnimationFrame(animate);
            }, []);

            // Generate spiky stock chart path: up → down → up
            const generateStockPath = () => {
                const width = 400;
                const height = 200;
                const startY = height * 0.7; // Start lower
                const midY = height * 0.3; // Peak in middle
                const endY = height * 0.2; // End higher
                
                // Create spiky path: up (with spikes) → down (with spikes) → up (with spikes)
                const points = [
                    { x: 0, y: startY },
                    { x: 30, y: startY - 20 },
                    { x: 50, y: startY - 10 },
                    { x: 70, y: startY - 30 },
                    { x: 90, y: startY - 15 },
                    { x: 110, y: startY - 40 },
                    { x: 130, y: startY - 25 },
                    { x: 150, y: midY }, // Peak
                    { x: 170, y: midY + 20 },
                    { x: 190, y: midY + 10 },
                    { x: 210, y: midY + 30 },
                    { x: 230, y: midY + 15 },
                    { x: 250, y: midY + 35 },
                    { x: 270, y: midY + 20 },
                    { x: 290, y: height * 0.5 }, // Bottom
                    { x: 310, y: height * 0.4 },
                    { x: 330, y: height * 0.35 },
                    { x: 350, y: height * 0.3 },
                    { x: 370, y: height * 0.25 },
                    { x: 390, y: endY }, // Final up
                    { x: 400, y: endY - 10 }
                ];
                
                let path = `M ${points[0].x} ${points[0].y}`;
                for (let i = 1; i < points.length; i++) {
                    path += ` L ${points[i].x} ${points[i].y}`;
                }
                
                return { path, lastPoint: points[points.length - 1] };
            };

            const { path, lastPoint } = generateStockPath();
            const visiblePath = drawProgress >= 1 ? path : path; // Could implement progressive drawing if needed

            return (
                <div 
                    className="fixed inset-0 bg-white flex items-center justify-center z-50 cursor-pointer"
                    onClick={handleClick}
                    style={{
                        opacity: showContent && !isExiting ? 1 : 0,
                        filter: isExiting ? 'blur(10px)' : 'blur(0px)',
                        transition: 'opacity 0.6s ease-in-out, filter 0.6s ease-in-out',
                        transform: isExiting ? 'scale(1.05)' : 'scale(1)',
                        willChange: 'opacity, filter, transform'
                    }}
                >
                    <div className="text-center relative">
                        {/* Animated Stock Chart */}
                        <div className="mb-12">
                            <svg 
                                width="400" 
                                height="200" 
                                viewBox="0 0 400 200" 
                                className="mx-auto"
                            >
                                <defs>
                                    <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stopColor="#3B82F6" />
                                        <stop offset="50%" stopColor="#10B981" />
                                        <stop offset="100%" stopColor="#3B82F6" />
                                    </linearGradient>
                                </defs>
                                
                                {/* Background grid */}
                                {[0, 50, 100, 150, 200].map((y, i) => (
                                    <line
                                        key={i}
                                        x1="0"
                                        y1={y}
                                        x2="400"
                                        y2={y}
                                        stroke="#E5E7EB"
                                        strokeWidth="1"
                                    />
                                ))}
                                
                                {/* Spiky stock line */}
                                <path
                                    d={visiblePath}
                                    fill="none"
                                    stroke="url(#lineGradient)"
                                    strokeWidth="3"
                                    strokeLinecap="round"
                                    strokeLinejoin="miter"
                                    style={{
                                        strokeDasharray: 1000,
                                        strokeDashoffset: 1000 * (1 - drawProgress),
                                        transition: 'stroke-dashoffset 0.1s linear'
                                    }}
                                />
                                
                                {/* Animated dot at the end */}
                                {drawProgress >= 1 && (
                                    <circle
                                        cx={lastPoint.x}
                                        cy={lastPoint.y}
                                        r="6"
                                        fill="#10B981"
                                        style={{
                                            animation: 'pulse 1.5s ease-in-out infinite',
                                            filter: 'drop-shadow(0 0 8px rgba(16, 185, 129, 0.6))'
                                        }}
                                    />
                                )}
                            </svg>
                        </div>
                        
                        {/* Arrow pointing up to title */}
                        <div className="mb-6" style={{ animation: 'fadeInUp 0.8s ease-out 0.5s both' }}>
                            <svg 
                                width="40" 
                                height="40" 
                                viewBox="0 0 24 24" 
                                className="mx-auto"
                                style={{
                                    animation: 'bounce 1.5s ease-in-out infinite 1s'
                                }}
                            >
                                <path
                                    d="M12 4 L12 20 M12 4 L6 10 M12 4 L18 10"
                                    stroke="#3B82F6"
                                    strokeWidth="2.5"
                                    strokeLinecap="round"
                                    strokeLinejoin="round"
                                    fill="none"
                                />
                            </svg>
                        </div>
                        
                        {/* Title */}
                        <h1 
                            className="text-6xl md:text-7xl font-bold text-gray-900 mb-4"
                            style={{
                                letterSpacing: '0.05em',
                                animation: 'fadeInUp 0.8s ease-out 0.7s both'
                            }}
                        >
                            StockSense
                        </h1>
                        
                        {/* Subtitle */}
                        <p 
                            className="text-xl text-gray-600 mt-4"
                            style={{
                                animation: 'fadeInUp 0.8s ease-out 0.9s both'
                            }}
                        >
                            Intelligent Stock Analysis
                        </p>
                        
                        {/* Click hint */}
                        <p 
                            className="text-sm text-gray-400 mt-8"
                            style={{
                                animation: 'fadeInUp 0.8s ease-out 1.1s both, pulse 2s ease-in-out infinite 2s'
                            }}
                        >
                            Click anywhere to continue
                        </p>
                    </div>
                    
                    <style>{`
                        @keyframes pulse {
                            0%, 100% {
                                opacity: 1;
                                transform: scale(1);
                            }
                            50% {
                                opacity: 0.7;
                                transform: scale(1.2);
                            }
                        }
                        @keyframes fadeInUp {
                            from {
                                opacity: 0;
                                transform: translateY(20px);
                            }
                            to {
                                opacity: 1;
                                transform: translateY(0);
                            }
                        }
                        @keyframes bounce {
                            0%, 100% {
                                transform: translateY(0);
                            }
                            50% {
                                transform: translateY(-10px);
                            }
                        }
                    `}</style>
                </div>
            );
        }

        // AI Chatbot Component
        function AIChatbot() {
            const [messages, setMessages] = useState([
                {
                    role: 'assistant',
                    content: "Hello! I'm your financial education assistant. I can help you understand financial terms, concepts, and how the stock market works. Ask me anything about finance, and I'll explain it in simple, beginner-friendly language. What would you like to learn about?"
                }
            ]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const chatEndRef = React.useRef(null);

            const scrollToBottom = () => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            React.useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const handleSend = async (e) => {
                e.preventDefault();
                if (!input.trim() || loading) return;

                const userMessage = input.trim();
                setInput('');
                setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
                setLoading(true);

                try {
                    const response = await sendChatMessage(userMessage);
                    setMessages(prev => [...prev, { role: 'assistant', content: response }]);
                } catch (error) {
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'Sorry, I encountered an error. Please make sure the backend server is running and try again. For technical issues, please contact aarushravi.09@gmail.com'
                    }]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="bg-white rounded-lg shadow-md flex flex-col" style={{ height: '600px' }}>
                    <div className="p-6 border-b border-gray-200">
                        <h2 className="text-2xl font-bold text-gray-900">AI Chatbot</h2>
                        <p className="text-sm text-gray-500 mt-1">Your financial education assistant</p>
                    </div>
                    
                    <div className="flex-1 overflow-y-auto p-6 space-y-4">
                        {messages.map((msg, idx) => (
                            <div
                                key={idx}
                                className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                            >
                                <div
                                    className={`max-w-[80%] rounded-lg p-4 ${
                                        msg.role === 'user'
                                            ? 'bg-blue-500 text-white'
                                            : 'bg-gray-100 text-gray-900'
                                    }`}
                                >
                                    <div className="whitespace-pre-wrap">{msg.content}</div>
                                </div>
                            </div>
                        ))}
                        {loading && (
                            <div className="flex justify-start">
                                <div className="bg-gray-100 rounded-lg p-4">
                                    <div className="flex space-x-2">
                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.4s' }}></div>
                                    </div>
                                </div>
                            </div>
                        )}
                        <div ref={chatEndRef} />
                    </div>
                    
                    <form onSubmit={handleSend} className="p-4 border-t border-gray-200">
                        <div className="flex gap-2">
                            <input
                                type="text"
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                placeholder="Ask me about financial terms, concepts, or how things work..."
                                className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                disabled={loading}
                            />
                            <button
                                type="submit"
                                disabled={loading || !input.trim()}
                                className="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                Send
                            </button>
                        </div>
                        <p className="text-xs text-gray-400 mt-2 text-center">
                            Note: This chatbot provides educational information only. It does not provide investment advice. Chats with this bot will not be saved.
                        </p>
                    </form>
                </div>
            );
        }

        // Main App Component
        function App() {
            const [showSplash, setShowSplash] = useState(true);
            const [currentView, setCurrentView] = useState('search');
            const [selectedSymbol, setSelectedSymbol] = useState(null);

            if (showSplash) {
                return <SplashScreen onComplete={() => setShowSplash(false)} />;
            }

            return (
                <StockProvider>
                    <div className="min-h-screen bg-white relative overflow-hidden">
                        {/* Background gradient decoration */}
                        <div className="absolute inset-0 bg-gradient-to-br from-gray-50 via-white to-gray-50 opacity-50"></div>
                        <div className="absolute top-0 right-0 w-96 h-96 bg-gray-100 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
                        <div className="absolute top-0 left-0 w-96 h-96 bg-gray-100 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>
                        <div className="absolute bottom-0 right-0 w-96 h-96 bg-gray-100 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000"></div>
                        
                        <div className="relative z-10">
                        <header className="bg-white/80 backdrop-blur-md shadow-sm border-b border-gray-100">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        <h1 className="text-3xl font-bold text-gray-800">StockSense</h1>
                                        <span className="text-sm text-gray-400 hidden sm:inline self-center">A tool for long-term investing</span>
                                    </div>
                                    <nav className="flex gap-2">
                                        <button
                                            onClick={() => { setCurrentView('search'); setSelectedSymbol(null); }}
                                            className={`p-2.5 rounded-lg transition-all duration-200 ${
                                                currentView === 'search' ? 'bg-gray-800 text-white shadow-md' : 'text-gray-500 hover:bg-gray-100 hover:text-gray-700 hover:scale-110'
                                            }`}
                                            title="Home"
                                        >
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => { setCurrentView('news'); setSelectedSymbol(null); }}
                                            className={`p-2.5 rounded-lg transition-all duration-200 ${
                                                currentView === 'news' ? 'bg-gray-800 text-white shadow-md' : 'text-gray-500 hover:bg-gray-100 hover:text-gray-700 hover:scale-110'
                                            }`}
                                            title="News"
                                        >
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => { setCurrentView('book'); setSelectedSymbol(null); }}
                                            className={`p-2.5 rounded-lg transition-all duration-200 ${
                                                currentView === 'book' ? 'bg-gray-800 text-white shadow-md' : 'text-gray-500 hover:bg-gray-100 hover:text-gray-700 hover:scale-110'
                                            }`}
                                            title="AI Chatbot"
                                        >
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => { setCurrentView('contact'); setSelectedSymbol(null); }}
                                            className={`p-2.5 rounded-lg transition-all duration-200 ${
                                                currentView === 'contact' ? 'bg-gray-800 text-white shadow-md' : 'text-gray-500 hover:bg-gray-100 hover:text-gray-700 hover:scale-110'
                                            }`}
                                            title="Contact"
                                        >
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => { setCurrentView('settings'); setSelectedSymbol(null); }}
                                            className={`p-2.5 rounded-lg transition-all duration-200 ${
                                                currentView === 'settings' ? 'bg-gray-800 text-white shadow-md' : 'text-gray-500 hover:bg-gray-100 hover:text-gray-700 hover:scale-110'
                                            }`}
                                            title="Settings"
                                        >
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            </svg>
                                        </button>
                                    </nav>
                                </div>
                            </div>
                        </header>

                        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 relative z-10">
                            {currentView === 'search' && (
                                <div>
                                    <StarredStocks onStockSelect={(symbol) => {
                                        setSelectedSymbol(symbol);
                                        setCurrentView('analysis');
                                    }} />
                                    <SearchBar onAnalysisComplete={(symbol) => {
                                        setSelectedSymbol(symbol);
                                        setCurrentView('analysis');
                                    }} />
                                </div>
                            )}
                            {currentView === 'analysis' && selectedSymbol && (
                                <StockAnalysis symbol={selectedSymbol} />
                            )}
                            {currentView === 'news' && (
                                <MarketNews />
                            )}
                            {currentView === 'contact' && (
                                <div className="bg-white rounded-lg shadow-md p-8">
                                    <h2 className="text-2xl font-bold text-gray-900 mb-6">Contact Us</h2>
                                    <div className="space-y-6 text-gray-700">
                                        <div>
                                            <p className="mb-4">
                                                If you have any questions, feedback, or suggestions regarding the Stock Analysis Tool, please feel free to reach out.
                                            </p>
                                            <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                                <p className="font-semibold text-gray-900 mb-2">Email:</p>
                                                <a 
                                                    href="mailto:aarushravi.09@gmail.com" 
                                                    className="text-gray-600 hover:text-gray-800 font-medium"
                                                >
                                                    aarushravi.09@gmail.com
                                                </a>
                                            </div>
                                        </div>
                                        
                                        <div className="border-t border-gray-200 pt-6">
                                            <h3 className="text-lg font-semibold text-gray-900 mb-4">Data Sources & APIs</h3>
                                            <p className="text-sm text-gray-600 mb-3">
                                                This tool utilizes the following services and data sources to provide comprehensive stock analysis:
                                            </p>
                                            <div className="grid md:grid-cols-2 gap-4 text-sm">
                                                <div>
                                                    <p className="font-semibold text-gray-900 mb-2">AI Services:</p>
                                                    <ul className="list-disc list-inside space-y-1 text-gray-600 ml-2">
                                                        <li>OpenAI</li>
                                                        <li>Anthropic</li>
                                                    </ul>
                                                </div>
                                                <div>
                                                    <p className="font-semibold text-gray-900 mb-2">Data Sources:</p>
                                                    <ul className="list-disc list-inside space-y-1 text-gray-600 ml-2">
                                                        <li>Yahoo Finance</li>
                                                        <li>StockTwits</li>
                                                        <li>Reddit</li>
                                                        <li>Google News</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {currentView === 'settings' && (
                                <div className="bg-white rounded-lg shadow-md p-8 text-center">
                                    <h2 className="text-2xl font-bold text-gray-900 mb-4">Settings</h2>
                                    <p className="text-gray-500">Settings page content will be added here.</p>
                                </div>
                            )}
                            {currentView === 'book' && (
                                <AIChatbot />
                            )}
                        </main>
                        </div>
                    </div>
                </StockProvider>
            );
        }

        // Render App - wait for Babel to process
        setTimeout(() => {
            const rootElement = document.getElementById('root');
            if (rootElement) {
                try {
                    if (ReactDOM.createRoot) {
                        const root = ReactDOM.createRoot(rootElement);
                        root.render(<App />);
                    } else {
                        // Fallback for older React versions
                        ReactDOM.render(<App />, rootElement);
                    }
                } catch (error) {
                    console.error('Error rendering app:', error);
                    rootElement.innerHTML = '<div style="padding: 20px; color: red; font-family: system-ui;">Error loading application: ' + error.message + '<br><br>Check console for details.</div>';
                }
            } else {
                console.error('Root element not found');
            }
        }, 100);
    </script>
</body>
</html>

